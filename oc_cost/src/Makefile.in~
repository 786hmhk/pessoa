MEXSUFFIX  = mex

SP_DIR     = lib

MEX        = @MEX@
CXX        = @CXX@
CXXFLAGS   = @CUDD_ICFLAGS@ @CUDD_XCFLAGS@
OBJFILES   = $(CUDD_DIR)/util/datalimit.o $(CUDD_DIR)/util/cpu_time.o $(CUDD_DIR)/util/safe_mem.o
CFLAGS     = -L$(MATLABHOME)/bin/$(SYSTEMEX) -L$(CUDD_DIR)/dddmp -L$(CUDD_DIR)/epd -L$(CUDD_DIR)/util -L$(CUDD_DIR)/st -L$(CUDD_DIR)/mtr -L$(CUDD_DIR)/cudd
LIBS       = -lmex -lmx -lmat -lcudd -lmtr -lst -lutil -lepd -ldddmp -lm
INCLUDE    = -I$(MATLABHOME)/extern/include -I$(CUDD_DIR)/include -I$(SP_DIR)
MEXFLAGS   = -cxx CC='$(CXX)' CXX='$(CXX)' LD='$(CXX)' CXXFLAGS='$(CXXFLAGS)'

COL_ON  = \033[0;32m
COL_OFF = \033[m

all: oc_sp_mex

oc_sp_mex: shortestPathMex.$(MEXSUFFIX) 

shortestPathMex.$(MEXSUFFIX): shortestPathMex.cpp $(SP_DIR)/cuddObj.cpp $(SP_DIR)/ShortestPath.cpp
	$(MEX) $(MEXFLAGS) $(CFLAGS) $(INCLUDE) $(LIBS) $(OBJFILES) $^ -output ../bin/shortestPathMex
	@echo "${COL_ON}\nCompilation Successful!\nAdd $(CURDIR) into your MATLAB path.\n ${COL_OFF}"
	

RM = rm -rf
clean:
	-@echo "${COL_ON}Cleaning oc_sp_mex Project ... ${COL_OFF}"
	-@cd ../bin && $(RM) shortestPathMex.* oc_sp_cpp *.dot *.bdd *.add tb_sys_info.txt test_symb.mat

distclean : clean

run:
	@cd ../bin/ && $(MATLABHOME)/bin/matlab -nosplash -nodesktop -r shortestPath
